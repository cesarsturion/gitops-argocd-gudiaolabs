name: Test Reusable WorkFlow user

on:
  workflow_dispatch:
  push:
    branches:
      - 'feature/*'
      - '!master'
      - '!main'
  pull_request:
    branches: 
      - 'master'
      - 'main'
  release:
    types:
      - 'created'

# jobs:
#   build:
#     uses: gudiaolabs/reusable-workflow/.github/workflows/createpublishdockerimage.yml@main
#     with:
#       image_name: gitops-argocd
#       tag: $GITHUB_RUN_NUMBER
#     secrets:
#       registry_username: ${{ secrets.DOCKER_USER }}
#       registry_password: ${{ secrets.DOCKER_PASSWORD }}

env:
  IMAGE_NAME: "gitops-argocd"

jobs:
  # build:
  #   name: Build and Pushing the Image
  #   runs-on: ubuntu-latest
  #   steps:      
  #     - uses: actions/checkout@v2
      
  #     - name: Login to the Registry
  #       uses: docker/login-action@v1
  #       with:
  #         username: ${{ secrets.DOCKER_USER }}
  #         password: ${{ secrets.DOCKER_PASSWORD }}
      
  #     - name: Set the tag
  #       run: |
  #         echo "TAG=${{ github.sha }} " >> $GITHUB_ENV

  #     - name: Build and Push the Image
  #       run: |
  #         docker build -t ${{ secrets.DOCKER_USER }}/$IMAGE_NAME:${{ env.TAG }} .
  #         docker push ${{ secrets.DOCKER_USER }}/$IMAGE_NAME:${{ env.TAG }}

  deploy: 
    name: Deploy
    runs-on: ubuntu-latest
    # needs: build
    steps:

      - name: Checkout Helm Chart repository
        uses: actions/checkout@v3
        with:
          repository: gudiaolabs/gudiaolabs-charts
          path: './gudiaolabs-charts'

      - name: List Files
        run: |
          ls -lha 


      # - name: update k8s
      #   run: |
      #     cd k8s
      #     kustomize edit set image go-app=csturion/go-app:${{ github.sha }}
      #     cat kustomization.yaml

      # - name: commit
      #   run: |
      #     git config --local user.email "action@github.com"
      #     git config --local user.name "Deploy Action"
      #     git commit -am "change image tag"

      # - name: push
      #   uses: ad-m/github-push-action@master
